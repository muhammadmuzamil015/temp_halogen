node('J-QMU-1') {
    stage('Clone Repository on bpif3') {
        // Checkout the SCM (Git repository)
        checkout scm
    }
    stage('Running Makefile for spike') {
        sh'''#!/bin/bash
            source "$MODULE_INIT"
            module load riscv64-gnu-glibc/02022024
            riscv64-unknown-linux-gnu-gcc --version
            module load spike/1.1.1-dev
            
            module load riscv64-gnu-elf/02022024
            
            find / -type f -name pk 2>/dev/null

            spike /home/jenkins_user/runner_dir/workspace/R-Halogen/riscv-pk/build/riscv64-unknown-elf/bin/pk
            spike --isa=rv64imafdcv_zba_zbb_zbc_zbs /softwares/RISCV/riscv-pk/573c858d9071a2216537f71de651a814f76ee76d/riscv64-unknown-elf/bin/pk test.elf
            make PK=/softwares/RISCV/riscv-pk/573c858d9071a2216537f71de651a814f76ee76d/riscv64-unknown-elf/bin/pk ARCH=riscv TARGET=spike SUBD=riscv SRCS=tests/performance/vadd_s8_rvv_test/vadd_s8_rvv_test.c
        '''
    }
    stage('Archive Spike Results') {
        archiveArtifacts artifacts: 'RUN/tests/performance/vadd_s8_rvv_test/riscv/spike/spike.out,RUN/tests/performance/vadd_s8_rvv_test/riscv/spike/spike.log', allowEmptyArchive: true
    } 
}
